<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `src/uu/dd/src/dd.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>dd.rs - source</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../normalize.css"><link rel="stylesheet" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../ayu.css" disabled><link rel="stylesheet" href="../../dark.css" disabled><link rel="stylesheet" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script defer src="../../source-script.js"></script><script defer src="../../source-files.js"></script><script defer src="../../main.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc source"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"></nav><main><div class="width-limiter"><nav class="sub"><a class="sub-logo-container" href="../../uu_dd/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><form class="search-form"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></form></nav><section id="main-content" class="content"><div class="example-wrap"><pre class="src-line-numbers"><span id="1">1</span>
<span id="2">2</span>
<span id="3">3</span>
<span id="4">4</span>
<span id="5">5</span>
<span id="6">6</span>
<span id="7">7</span>
<span id="8">8</span>
<span id="9">9</span>
<span id="10">10</span>
<span id="11">11</span>
<span id="12">12</span>
<span id="13">13</span>
<span id="14">14</span>
<span id="15">15</span>
<span id="16">16</span>
<span id="17">17</span>
<span id="18">18</span>
<span id="19">19</span>
<span id="20">20</span>
<span id="21">21</span>
<span id="22">22</span>
<span id="23">23</span>
<span id="24">24</span>
<span id="25">25</span>
<span id="26">26</span>
<span id="27">27</span>
<span id="28">28</span>
<span id="29">29</span>
<span id="30">30</span>
<span id="31">31</span>
<span id="32">32</span>
<span id="33">33</span>
<span id="34">34</span>
<span id="35">35</span>
<span id="36">36</span>
<span id="37">37</span>
<span id="38">38</span>
<span id="39">39</span>
<span id="40">40</span>
<span id="41">41</span>
<span id="42">42</span>
<span id="43">43</span>
<span id="44">44</span>
<span id="45">45</span>
<span id="46">46</span>
<span id="47">47</span>
<span id="48">48</span>
<span id="49">49</span>
<span id="50">50</span>
<span id="51">51</span>
<span id="52">52</span>
<span id="53">53</span>
<span id="54">54</span>
<span id="55">55</span>
<span id="56">56</span>
<span id="57">57</span>
<span id="58">58</span>
<span id="59">59</span>
<span id="60">60</span>
<span id="61">61</span>
<span id="62">62</span>
<span id="63">63</span>
<span id="64">64</span>
<span id="65">65</span>
<span id="66">66</span>
<span id="67">67</span>
<span id="68">68</span>
<span id="69">69</span>
<span id="70">70</span>
<span id="71">71</span>
<span id="72">72</span>
<span id="73">73</span>
<span id="74">74</span>
<span id="75">75</span>
<span id="76">76</span>
<span id="77">77</span>
<span id="78">78</span>
<span id="79">79</span>
<span id="80">80</span>
<span id="81">81</span>
<span id="82">82</span>
<span id="83">83</span>
<span id="84">84</span>
<span id="85">85</span>
<span id="86">86</span>
<span id="87">87</span>
<span id="88">88</span>
<span id="89">89</span>
<span id="90">90</span>
<span id="91">91</span>
<span id="92">92</span>
<span id="93">93</span>
<span id="94">94</span>
<span id="95">95</span>
<span id="96">96</span>
<span id="97">97</span>
<span id="98">98</span>
<span id="99">99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
<span id="276">276</span>
<span id="277">277</span>
<span id="278">278</span>
<span id="279">279</span>
<span id="280">280</span>
<span id="281">281</span>
<span id="282">282</span>
<span id="283">283</span>
<span id="284">284</span>
<span id="285">285</span>
<span id="286">286</span>
<span id="287">287</span>
<span id="288">288</span>
<span id="289">289</span>
<span id="290">290</span>
<span id="291">291</span>
<span id="292">292</span>
<span id="293">293</span>
<span id="294">294</span>
<span id="295">295</span>
<span id="296">296</span>
<span id="297">297</span>
<span id="298">298</span>
<span id="299">299</span>
<span id="300">300</span>
<span id="301">301</span>
<span id="302">302</span>
<span id="303">303</span>
<span id="304">304</span>
<span id="305">305</span>
<span id="306">306</span>
<span id="307">307</span>
<span id="308">308</span>
<span id="309">309</span>
<span id="310">310</span>
<span id="311">311</span>
<span id="312">312</span>
<span id="313">313</span>
<span id="314">314</span>
<span id="315">315</span>
<span id="316">316</span>
<span id="317">317</span>
<span id="318">318</span>
<span id="319">319</span>
<span id="320">320</span>
<span id="321">321</span>
<span id="322">322</span>
<span id="323">323</span>
<span id="324">324</span>
<span id="325">325</span>
<span id="326">326</span>
<span id="327">327</span>
<span id="328">328</span>
<span id="329">329</span>
<span id="330">330</span>
<span id="331">331</span>
<span id="332">332</span>
<span id="333">333</span>
<span id="334">334</span>
<span id="335">335</span>
<span id="336">336</span>
<span id="337">337</span>
<span id="338">338</span>
<span id="339">339</span>
<span id="340">340</span>
<span id="341">341</span>
<span id="342">342</span>
<span id="343">343</span>
<span id="344">344</span>
<span id="345">345</span>
<span id="346">346</span>
<span id="347">347</span>
<span id="348">348</span>
<span id="349">349</span>
<span id="350">350</span>
<span id="351">351</span>
<span id="352">352</span>
<span id="353">353</span>
<span id="354">354</span>
<span id="355">355</span>
<span id="356">356</span>
<span id="357">357</span>
<span id="358">358</span>
<span id="359">359</span>
<span id="360">360</span>
<span id="361">361</span>
<span id="362">362</span>
<span id="363">363</span>
<span id="364">364</span>
<span id="365">365</span>
<span id="366">366</span>
<span id="367">367</span>
<span id="368">368</span>
<span id="369">369</span>
<span id="370">370</span>
<span id="371">371</span>
<span id="372">372</span>
<span id="373">373</span>
<span id="374">374</span>
<span id="375">375</span>
<span id="376">376</span>
<span id="377">377</span>
<span id="378">378</span>
<span id="379">379</span>
<span id="380">380</span>
<span id="381">381</span>
<span id="382">382</span>
<span id="383">383</span>
<span id="384">384</span>
<span id="385">385</span>
<span id="386">386</span>
<span id="387">387</span>
<span id="388">388</span>
<span id="389">389</span>
<span id="390">390</span>
<span id="391">391</span>
<span id="392">392</span>
<span id="393">393</span>
<span id="394">394</span>
<span id="395">395</span>
<span id="396">396</span>
<span id="397">397</span>
<span id="398">398</span>
<span id="399">399</span>
<span id="400">400</span>
<span id="401">401</span>
<span id="402">402</span>
<span id="403">403</span>
<span id="404">404</span>
<span id="405">405</span>
<span id="406">406</span>
<span id="407">407</span>
<span id="408">408</span>
<span id="409">409</span>
<span id="410">410</span>
<span id="411">411</span>
<span id="412">412</span>
<span id="413">413</span>
<span id="414">414</span>
<span id="415">415</span>
<span id="416">416</span>
<span id="417">417</span>
<span id="418">418</span>
<span id="419">419</span>
<span id="420">420</span>
<span id="421">421</span>
<span id="422">422</span>
<span id="423">423</span>
<span id="424">424</span>
<span id="425">425</span>
<span id="426">426</span>
<span id="427">427</span>
<span id="428">428</span>
<span id="429">429</span>
<span id="430">430</span>
<span id="431">431</span>
<span id="432">432</span>
<span id="433">433</span>
<span id="434">434</span>
<span id="435">435</span>
<span id="436">436</span>
<span id="437">437</span>
<span id="438">438</span>
<span id="439">439</span>
<span id="440">440</span>
<span id="441">441</span>
<span id="442">442</span>
<span id="443">443</span>
<span id="444">444</span>
<span id="445">445</span>
<span id="446">446</span>
<span id="447">447</span>
<span id="448">448</span>
<span id="449">449</span>
<span id="450">450</span>
<span id="451">451</span>
<span id="452">452</span>
<span id="453">453</span>
<span id="454">454</span>
<span id="455">455</span>
<span id="456">456</span>
<span id="457">457</span>
<span id="458">458</span>
<span id="459">459</span>
<span id="460">460</span>
<span id="461">461</span>
<span id="462">462</span>
<span id="463">463</span>
<span id="464">464</span>
<span id="465">465</span>
<span id="466">466</span>
<span id="467">467</span>
<span id="468">468</span>
<span id="469">469</span>
<span id="470">470</span>
<span id="471">471</span>
<span id="472">472</span>
<span id="473">473</span>
<span id="474">474</span>
<span id="475">475</span>
<span id="476">476</span>
<span id="477">477</span>
<span id="478">478</span>
<span id="479">479</span>
<span id="480">480</span>
<span id="481">481</span>
<span id="482">482</span>
<span id="483">483</span>
<span id="484">484</span>
<span id="485">485</span>
<span id="486">486</span>
<span id="487">487</span>
<span id="488">488</span>
<span id="489">489</span>
<span id="490">490</span>
<span id="491">491</span>
<span id="492">492</span>
<span id="493">493</span>
<span id="494">494</span>
<span id="495">495</span>
<span id="496">496</span>
<span id="497">497</span>
<span id="498">498</span>
<span id="499">499</span>
<span id="500">500</span>
<span id="501">501</span>
<span id="502">502</span>
<span id="503">503</span>
<span id="504">504</span>
<span id="505">505</span>
<span id="506">506</span>
<span id="507">507</span>
<span id="508">508</span>
<span id="509">509</span>
<span id="510">510</span>
<span id="511">511</span>
<span id="512">512</span>
<span id="513">513</span>
<span id="514">514</span>
<span id="515">515</span>
<span id="516">516</span>
<span id="517">517</span>
<span id="518">518</span>
<span id="519">519</span>
<span id="520">520</span>
<span id="521">521</span>
<span id="522">522</span>
<span id="523">523</span>
<span id="524">524</span>
<span id="525">525</span>
<span id="526">526</span>
<span id="527">527</span>
<span id="528">528</span>
<span id="529">529</span>
<span id="530">530</span>
<span id="531">531</span>
<span id="532">532</span>
<span id="533">533</span>
<span id="534">534</span>
<span id="535">535</span>
<span id="536">536</span>
<span id="537">537</span>
<span id="538">538</span>
<span id="539">539</span>
<span id="540">540</span>
<span id="541">541</span>
<span id="542">542</span>
<span id="543">543</span>
<span id="544">544</span>
<span id="545">545</span>
<span id="546">546</span>
<span id="547">547</span>
<span id="548">548</span>
<span id="549">549</span>
<span id="550">550</span>
<span id="551">551</span>
<span id="552">552</span>
<span id="553">553</span>
<span id="554">554</span>
<span id="555">555</span>
<span id="556">556</span>
<span id="557">557</span>
<span id="558">558</span>
<span id="559">559</span>
<span id="560">560</span>
<span id="561">561</span>
<span id="562">562</span>
<span id="563">563</span>
<span id="564">564</span>
<span id="565">565</span>
<span id="566">566</span>
<span id="567">567</span>
<span id="568">568</span>
<span id="569">569</span>
<span id="570">570</span>
<span id="571">571</span>
<span id="572">572</span>
<span id="573">573</span>
<span id="574">574</span>
<span id="575">575</span>
<span id="576">576</span>
<span id="577">577</span>
<span id="578">578</span>
<span id="579">579</span>
<span id="580">580</span>
<span id="581">581</span>
<span id="582">582</span>
<span id="583">583</span>
<span id="584">584</span>
<span id="585">585</span>
<span id="586">586</span>
<span id="587">587</span>
<span id="588">588</span>
<span id="589">589</span>
<span id="590">590</span>
<span id="591">591</span>
<span id="592">592</span>
<span id="593">593</span>
<span id="594">594</span>
<span id="595">595</span>
<span id="596">596</span>
<span id="597">597</span>
<span id="598">598</span>
<span id="599">599</span>
<span id="600">600</span>
<span id="601">601</span>
<span id="602">602</span>
<span id="603">603</span>
<span id="604">604</span>
<span id="605">605</span>
<span id="606">606</span>
<span id="607">607</span>
<span id="608">608</span>
<span id="609">609</span>
<span id="610">610</span>
<span id="611">611</span>
<span id="612">612</span>
<span id="613">613</span>
<span id="614">614</span>
<span id="615">615</span>
<span id="616">616</span>
<span id="617">617</span>
<span id="618">618</span>
<span id="619">619</span>
<span id="620">620</span>
<span id="621">621</span>
<span id="622">622</span>
<span id="623">623</span>
<span id="624">624</span>
<span id="625">625</span>
<span id="626">626</span>
<span id="627">627</span>
<span id="628">628</span>
<span id="629">629</span>
<span id="630">630</span>
<span id="631">631</span>
<span id="632">632</span>
<span id="633">633</span>
<span id="634">634</span>
<span id="635">635</span>
<span id="636">636</span>
<span id="637">637</span>
<span id="638">638</span>
<span id="639">639</span>
<span id="640">640</span>
<span id="641">641</span>
<span id="642">642</span>
<span id="643">643</span>
<span id="644">644</span>
<span id="645">645</span>
<span id="646">646</span>
<span id="647">647</span>
<span id="648">648</span>
<span id="649">649</span>
<span id="650">650</span>
<span id="651">651</span>
<span id="652">652</span>
<span id="653">653</span>
<span id="654">654</span>
<span id="655">655</span>
<span id="656">656</span>
<span id="657">657</span>
<span id="658">658</span>
<span id="659">659</span>
<span id="660">660</span>
<span id="661">661</span>
<span id="662">662</span>
<span id="663">663</span>
<span id="664">664</span>
<span id="665">665</span>
<span id="666">666</span>
<span id="667">667</span>
<span id="668">668</span>
<span id="669">669</span>
<span id="670">670</span>
<span id="671">671</span>
<span id="672">672</span>
<span id="673">673</span>
<span id="674">674</span>
<span id="675">675</span>
<span id="676">676</span>
<span id="677">677</span>
<span id="678">678</span>
<span id="679">679</span>
<span id="680">680</span>
<span id="681">681</span>
<span id="682">682</span>
<span id="683">683</span>
<span id="684">684</span>
<span id="685">685</span>
<span id="686">686</span>
<span id="687">687</span>
<span id="688">688</span>
<span id="689">689</span>
<span id="690">690</span>
<span id="691">691</span>
<span id="692">692</span>
<span id="693">693</span>
<span id="694">694</span>
<span id="695">695</span>
<span id="696">696</span>
<span id="697">697</span>
<span id="698">698</span>
<span id="699">699</span>
<span id="700">700</span>
<span id="701">701</span>
<span id="702">702</span>
<span id="703">703</span>
<span id="704">704</span>
<span id="705">705</span>
<span id="706">706</span>
<span id="707">707</span>
<span id="708">708</span>
<span id="709">709</span>
<span id="710">710</span>
<span id="711">711</span>
<span id="712">712</span>
<span id="713">713</span>
<span id="714">714</span>
<span id="715">715</span>
<span id="716">716</span>
<span id="717">717</span>
<span id="718">718</span>
<span id="719">719</span>
<span id="720">720</span>
<span id="721">721</span>
<span id="722">722</span>
<span id="723">723</span>
<span id="724">724</span>
<span id="725">725</span>
<span id="726">726</span>
<span id="727">727</span>
<span id="728">728</span>
<span id="729">729</span>
<span id="730">730</span>
<span id="731">731</span>
<span id="732">732</span>
<span id="733">733</span>
<span id="734">734</span>
<span id="735">735</span>
<span id="736">736</span>
<span id="737">737</span>
<span id="738">738</span>
<span id="739">739</span>
<span id="740">740</span>
<span id="741">741</span>
<span id="742">742</span>
<span id="743">743</span>
<span id="744">744</span>
<span id="745">745</span>
<span id="746">746</span>
<span id="747">747</span>
<span id="748">748</span>
<span id="749">749</span>
<span id="750">750</span>
<span id="751">751</span>
<span id="752">752</span>
<span id="753">753</span>
<span id="754">754</span>
<span id="755">755</span>
<span id="756">756</span>
<span id="757">757</span>
<span id="758">758</span>
<span id="759">759</span>
<span id="760">760</span>
<span id="761">761</span>
<span id="762">762</span>
<span id="763">763</span>
<span id="764">764</span>
<span id="765">765</span>
<span id="766">766</span>
<span id="767">767</span>
<span id="768">768</span>
<span id="769">769</span>
<span id="770">770</span>
<span id="771">771</span>
<span id="772">772</span>
<span id="773">773</span>
<span id="774">774</span>
<span id="775">775</span>
<span id="776">776</span>
<span id="777">777</span>
<span id="778">778</span>
<span id="779">779</span>
<span id="780">780</span>
<span id="781">781</span>
<span id="782">782</span>
<span id="783">783</span>
<span id="784">784</span>
<span id="785">785</span>
<span id="786">786</span>
<span id="787">787</span>
<span id="788">788</span>
<span id="789">789</span>
<span id="790">790</span>
<span id="791">791</span>
<span id="792">792</span>
<span id="793">793</span>
<span id="794">794</span>
<span id="795">795</span>
<span id="796">796</span>
<span id="797">797</span>
<span id="798">798</span>
<span id="799">799</span>
<span id="800">800</span>
<span id="801">801</span>
<span id="802">802</span>
<span id="803">803</span>
<span id="804">804</span>
<span id="805">805</span>
<span id="806">806</span>
<span id="807">807</span>
<span id="808">808</span>
<span id="809">809</span>
<span id="810">810</span>
<span id="811">811</span>
<span id="812">812</span>
<span id="813">813</span>
<span id="814">814</span>
<span id="815">815</span>
<span id="816">816</span>
<span id="817">817</span>
<span id="818">818</span>
<span id="819">819</span>
<span id="820">820</span>
<span id="821">821</span>
<span id="822">822</span>
<span id="823">823</span>
<span id="824">824</span>
<span id="825">825</span>
<span id="826">826</span>
<span id="827">827</span>
<span id="828">828</span>
<span id="829">829</span>
<span id="830">830</span>
<span id="831">831</span>
<span id="832">832</span>
<span id="833">833</span>
<span id="834">834</span>
<span id="835">835</span>
<span id="836">836</span>
<span id="837">837</span>
<span id="838">838</span>
<span id="839">839</span>
<span id="840">840</span>
<span id="841">841</span>
<span id="842">842</span>
<span id="843">843</span>
<span id="844">844</span>
<span id="845">845</span>
<span id="846">846</span>
<span id="847">847</span>
<span id="848">848</span>
<span id="849">849</span>
<span id="850">850</span>
<span id="851">851</span>
<span id="852">852</span>
<span id="853">853</span>
<span id="854">854</span>
<span id="855">855</span>
<span id="856">856</span>
<span id="857">857</span>
<span id="858">858</span>
<span id="859">859</span>
<span id="860">860</span>
<span id="861">861</span>
<span id="862">862</span>
<span id="863">863</span>
<span id="864">864</span>
<span id="865">865</span>
<span id="866">866</span>
<span id="867">867</span>
<span id="868">868</span>
<span id="869">869</span>
<span id="870">870</span>
<span id="871">871</span>
<span id="872">872</span>
<span id="873">873</span>
<span id="874">874</span>
<span id="875">875</span>
<span id="876">876</span>
<span id="877">877</span>
<span id="878">878</span>
<span id="879">879</span>
<span id="880">880</span>
<span id="881">881</span>
<span id="882">882</span>
<span id="883">883</span>
<span id="884">884</span>
<span id="885">885</span>
<span id="886">886</span>
<span id="887">887</span>
<span id="888">888</span>
<span id="889">889</span>
<span id="890">890</span>
<span id="891">891</span>
<span id="892">892</span>
<span id="893">893</span>
<span id="894">894</span>
<span id="895">895</span>
<span id="896">896</span>
<span id="897">897</span>
<span id="898">898</span>
<span id="899">899</span>
<span id="900">900</span>
<span id="901">901</span>
<span id="902">902</span>
<span id="903">903</span>
<span id="904">904</span>
<span id="905">905</span>
<span id="906">906</span>
<span id="907">907</span>
<span id="908">908</span>
<span id="909">909</span>
<span id="910">910</span>
<span id="911">911</span>
<span id="912">912</span>
<span id="913">913</span>
<span id="914">914</span>
<span id="915">915</span>
<span id="916">916</span>
<span id="917">917</span>
<span id="918">918</span>
<span id="919">919</span>
<span id="920">920</span>
<span id="921">921</span>
<span id="922">922</span>
<span id="923">923</span>
<span id="924">924</span>
<span id="925">925</span>
<span id="926">926</span>
</pre><pre class="rust"><code><span class="comment">// This file is part of the uutils coreutils package.
//
// (c) Tyler Steele &lt;tyler.steele@protonmail.com&gt;
//
// For the full copyright and license information, please view the LICENSE
// file that was distributed with this source code.

// spell-checker:ignore fname, tname, fpath, specfile, testfile, unspec, ifile, ofile, outfile, fullblock, urand, fileio, atoe, atoibm, behaviour, bmax, bremain, cflags, creat, ctable, ctty, datastructures, doesnt, etoa, fileout, fname, gnudd, iconvflags, iseek, nocache, noctty, noerror, nofollow, nolinks, nonblock, oconvflags, oseek, outfile, parseargs, rlen, rmax, rremain, rsofar, rstat, sigusr, wlen, wstat seekable oconv canonicalized

</span><span class="kw">mod </span>datastructures;
<span class="kw">use </span>datastructures::<span class="kw-2">*</span>;

<span class="kw">mod </span>parseargs;
<span class="kw">use </span>parseargs::Parser;

<span class="kw">mod </span>conversion_tables;

<span class="kw">mod </span>progress;
<span class="kw">use </span>progress::{gen_prog_updater, ProgUpdate, ReadStat, StatusLevel, WriteStat};

<span class="kw">mod </span>blocks;
<span class="kw">use </span>blocks::conv_block_unblock_helper;

<span class="kw">mod </span>numbers;

<span class="kw">use </span>std::cmp;
<span class="kw">use </span>std::env;
<span class="kw">use </span>std::ffi::OsString;
<span class="kw">use </span>std::fs::{File, OpenOptions};
<span class="kw">use </span>std::io::{<span class="self">self</span>, Read, Seek, SeekFrom, Stdout, Write};
<span class="attribute">#[cfg(any(target_os = <span class="string">&quot;linux&quot;</span>, target_os = <span class="string">&quot;android&quot;</span>))]
</span><span class="kw">use </span>std::os::unix::fs::OpenOptionsExt;
<span class="kw">use </span>std::path::Path;
<span class="kw">use </span>std::sync::mpsc;
<span class="kw">use </span>std::thread;
<span class="kw">use </span>std::time;

<span class="kw">use </span>clap::{crate_version, Arg, Command};
<span class="kw">use </span>gcd::Gcd;
<span class="kw">use </span>uucore::display::Quotable;
<span class="kw">use </span>uucore::error::{FromIo, UResult};
<span class="kw">use </span>uucore::help_section;
<span class="kw">use </span>uucore::show_error;

<span class="kw">const </span>ABOUT: <span class="kw-2">&amp;</span>str = <span class="macro">help_section!</span>(<span class="string">&quot;about&quot;</span>, <span class="string">&quot;dd.md&quot;</span>);
<span class="kw">const </span>AFTER_HELP: <span class="kw-2">&amp;</span>str = <span class="macro">help_section!</span>(<span class="string">&quot;after help&quot;</span>, <span class="string">&quot;dd.md&quot;</span>);
<span class="kw">const </span>BUF_INIT_BYTE: u8 = <span class="number">0xDD</span>;

<span class="doccomment">/// Final settings after parsing
</span><span class="attribute">#[derive(Default)]
</span><span class="kw">struct </span>Settings {
    infile: <span class="prelude-ty">Option</span>&lt;String&gt;,
    outfile: <span class="prelude-ty">Option</span>&lt;String&gt;,
    ibs: usize,
    obs: usize,
    skip: u64,
    seek: u64,
    count: <span class="prelude-ty">Option</span>&lt;Num&gt;,
    iconv: IConvFlags,
    iflags: IFlags,
    oconv: OConvFlags,
    oflags: OFlags,
    status: <span class="prelude-ty">Option</span>&lt;StatusLevel&gt;,
}

<span class="doccomment">/// A number in blocks or bytes
///
/// Some values (seek, skip, iseek, oseek) can have values either in blocks or in bytes.
/// We need to remember this because the size of the blocks (ibs) is only known after parsing
/// all the arguments.
</span><span class="attribute">#[derive(Clone, Copy, Debug, PartialEq)]
</span><span class="kw">enum </span>Num {
    Blocks(u64),
    Bytes(u64),
}

<span class="kw">impl </span>Num {
    <span class="kw">fn </span>force_bytes_if(<span class="self">self</span>, force: bool) -&gt; <span class="self">Self </span>{
        <span class="kw">match </span><span class="self">self </span>{
            <span class="self">Self</span>::Blocks(n) <span class="kw">if </span>force =&gt; <span class="self">Self</span>::Bytes(n),
            count =&gt; count,
        }
    }

    <span class="kw">fn </span>to_bytes(<span class="self">self</span>, block_size: u64) -&gt; u64 {
        <span class="kw">match </span><span class="self">self </span>{
            <span class="self">Self</span>::Blocks(n) =&gt; n * block_size,
            <span class="self">Self</span>::Bytes(n) =&gt; n,
        }
    }
}

<span class="kw">struct </span>Input&lt;<span class="lifetime">&#39;a</span>, R: Read&gt; {
    src: R,
    settings: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>Settings,
}

<span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>&gt; Input&lt;<span class="lifetime">&#39;a</span>, io::Stdin&gt; {
    <span class="kw">fn </span>new(settings: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>Settings) -&gt; UResult&lt;<span class="self">Self</span>&gt; {
        <span class="kw">let </span><span class="kw-2">mut </span>input = <span class="self">Self </span>{
            src: io::stdin(),
            settings,
        };

        <span class="kw">if </span>settings.skip &gt; <span class="number">0 </span>{
            <span class="kw">if let </span><span class="prelude-val">Err</span>(e) = input.read_skip(settings.skip) {
                <span class="kw">if let </span>io::ErrorKind::UnexpectedEof = e.kind() {
                    <span class="macro">show_error!</span>(<span class="string">&quot;&#39;standard input&#39;: cannot skip to specified offset&quot;</span>);
                } <span class="kw">else </span>{
                    <span class="kw">return </span>io::Result::Err(e)
                        .map_err_context(|| <span class="string">&quot;I/O error while skipping&quot;</span>.to_string());
                }
            }
        }

        <span class="prelude-val">Ok</span>(input)
    }
}

<span class="attribute">#[cfg(any(target_os = <span class="string">&quot;linux&quot;</span>, target_os = <span class="string">&quot;android&quot;</span>))]
</span><span class="kw">fn </span>make_linux_iflags(iflags: <span class="kw-2">&amp;</span>IFlags) -&gt; <span class="prelude-ty">Option</span>&lt;libc::c_int&gt; {
    <span class="kw">let </span><span class="kw-2">mut </span>flag = <span class="number">0</span>;

    <span class="kw">if </span>iflags.direct {
        flag |= libc::O_DIRECT;
    }
    <span class="kw">if </span>iflags.directory {
        flag |= libc::O_DIRECTORY;
    }
    <span class="kw">if </span>iflags.dsync {
        flag |= libc::O_DSYNC;
    }
    <span class="kw">if </span>iflags.noatime {
        flag |= libc::O_NOATIME;
    }
    <span class="kw">if </span>iflags.noctty {
        flag |= libc::O_NOCTTY;
    }
    <span class="kw">if </span>iflags.nofollow {
        flag |= libc::O_NOFOLLOW;
    }
    <span class="kw">if </span>iflags.nonblock {
        flag |= libc::O_NONBLOCK;
    }
    <span class="kw">if </span>iflags.sync {
        flag |= libc::O_SYNC;
    }

    <span class="kw">if </span>flag != <span class="number">0 </span>{
        <span class="prelude-val">Some</span>(flag)
    } <span class="kw">else </span>{
        <span class="prelude-val">None
    </span>}
}

<span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>&gt; Input&lt;<span class="lifetime">&#39;a</span>, File&gt; {
    <span class="kw">fn </span>new(filename: <span class="kw-2">&amp;</span>Path, settings: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>Settings) -&gt; UResult&lt;<span class="self">Self</span>&gt; {
        <span class="kw">let </span><span class="kw-2">mut </span>src = {
            <span class="kw">let </span><span class="kw-2">mut </span>opts = OpenOptions::new();
            opts.read(<span class="bool-val">true</span>);

            <span class="attribute">#[cfg(any(target_os = <span class="string">&quot;linux&quot;</span>, target_os = <span class="string">&quot;android&quot;</span>))]
            </span><span class="kw">if let </span><span class="prelude-val">Some</span>(libc_flags) = make_linux_iflags(<span class="kw-2">&amp;</span>settings.iflags) {
                opts.custom_flags(libc_flags);
            }

            opts.open(filename)
                .map_err_context(|| <span class="macro">format!</span>(<span class="string">&quot;failed to open {}&quot;</span>, filename.quote()))<span class="question-mark">?
        </span>};

        <span class="kw">if </span>settings.skip &gt; <span class="number">0 </span>{
            src.seek(io::SeekFrom::Start(settings.skip))
                .map_err_context(|| <span class="string">&quot;failed to seek in input file&quot;</span>.to_string())<span class="question-mark">?</span>;
        }

        <span class="prelude-val">Ok</span>(<span class="self">Self </span>{ src, settings })
    }
}

<span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>, R: Read&gt; Read <span class="kw">for </span>Input&lt;<span class="lifetime">&#39;a</span>, R&gt; {
    <span class="kw">fn </span>read(<span class="kw-2">&amp;mut </span><span class="self">self</span>, buf: <span class="kw-2">&amp;mut </span>[u8]) -&gt; io::Result&lt;usize&gt; {
        <span class="kw">let </span><span class="kw-2">mut </span>base_idx = <span class="number">0</span>;
        <span class="kw">let </span>target_len = buf.len();
        <span class="kw">loop </span>{
            <span class="kw">match </span><span class="self">self</span>.src.read(<span class="kw-2">&amp;mut </span>buf[base_idx..]) {
                <span class="prelude-val">Ok</span>(<span class="number">0</span>) =&gt; <span class="kw">return </span><span class="prelude-val">Ok</span>(base_idx),
                <span class="prelude-val">Ok</span>(rlen) <span class="kw">if </span><span class="self">self</span>.settings.iflags.fullblock =&gt; {
                    base_idx += rlen;

                    <span class="kw">if </span>base_idx &gt;= target_len {
                        <span class="kw">return </span><span class="prelude-val">Ok</span>(target_len);
                    }
                }
                <span class="prelude-val">Ok</span>(len) =&gt; <span class="kw">return </span><span class="prelude-val">Ok</span>(len),
                <span class="prelude-val">Err</span>(e) <span class="kw">if </span>e.kind() == io::ErrorKind::Interrupted =&gt; <span class="kw">continue</span>,
                <span class="prelude-val">Err</span>(<span class="kw">_</span>) <span class="kw">if </span><span class="self">self</span>.settings.iconv.noerror =&gt; <span class="kw">return </span><span class="prelude-val">Ok</span>(base_idx),
                <span class="prelude-val">Err</span>(e) =&gt; <span class="kw">return </span><span class="prelude-val">Err</span>(e),
            }
        }
    }
}

<span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>, R: Read&gt; Input&lt;<span class="lifetime">&#39;a</span>, R&gt; {
    <span class="doccomment">/// Fills a given buffer.
    /// Reads in increments of &#39;self.ibs&#39;.
    /// The start of each ibs-sized read follows the previous one.
    </span><span class="kw">fn </span>fill_consecutive(<span class="kw-2">&amp;mut </span><span class="self">self</span>, buf: <span class="kw-2">&amp;mut </span>Vec&lt;u8&gt;) -&gt; std::io::Result&lt;ReadStat&gt; {
        <span class="kw">let </span><span class="kw-2">mut </span>reads_complete = <span class="number">0</span>;
        <span class="kw">let </span><span class="kw-2">mut </span>reads_partial = <span class="number">0</span>;
        <span class="kw">let </span><span class="kw-2">mut </span>bytes_total = <span class="number">0</span>;

        <span class="kw">for </span>chunk <span class="kw">in </span>buf.chunks_mut(<span class="self">self</span>.settings.ibs) {
            <span class="kw">match </span><span class="self">self</span>.read(chunk)<span class="question-mark">? </span>{
                rlen <span class="kw">if </span>rlen == <span class="self">self</span>.settings.ibs =&gt; {
                    bytes_total += rlen;
                    reads_complete += <span class="number">1</span>;
                }
                rlen <span class="kw">if </span>rlen &gt; <span class="number">0 </span>=&gt; {
                    bytes_total += rlen;
                    reads_partial += <span class="number">1</span>;
                }
                <span class="kw">_ </span>=&gt; <span class="kw">break</span>,
            }
        }

        buf.truncate(bytes_total);
        <span class="prelude-val">Ok</span>(ReadStat {
            reads_complete,
            reads_partial,
            <span class="comment">// Records are not truncated when filling.
            </span>records_truncated: <span class="number">0</span>,
        })
    }

    <span class="doccomment">/// Fills a given buffer.
    /// Reads in increments of &#39;self.ibs&#39;.
    /// The start of each ibs-sized read is aligned to multiples of ibs; remaining space is filled with the &#39;pad&#39; byte.
    </span><span class="kw">fn </span>fill_blocks(<span class="kw-2">&amp;mut </span><span class="self">self</span>, buf: <span class="kw-2">&amp;mut </span>Vec&lt;u8&gt;, pad: u8) -&gt; std::io::Result&lt;ReadStat&gt; {
        <span class="kw">let </span><span class="kw-2">mut </span>reads_complete = <span class="number">0</span>;
        <span class="kw">let </span><span class="kw-2">mut </span>reads_partial = <span class="number">0</span>;
        <span class="kw">let </span><span class="kw-2">mut </span>base_idx = <span class="number">0</span>;

        <span class="kw">while </span>base_idx &lt; buf.len() {
            <span class="kw">let </span>next_blk = cmp::min(base_idx + <span class="self">self</span>.settings.ibs, buf.len());
            <span class="kw">let </span>target_len = next_blk - base_idx;

            <span class="kw">match </span><span class="self">self</span>.read(<span class="kw-2">&amp;mut </span>buf[base_idx..next_blk])<span class="question-mark">? </span>{
                <span class="number">0 </span>=&gt; <span class="kw">break</span>,
                rlen <span class="kw">if </span>rlen &lt; target_len =&gt; {
                    reads_partial += <span class="number">1</span>;
                    <span class="kw">let </span>padding = <span class="macro">vec!</span>[pad; target_len - rlen];
                    buf.splice(base_idx + rlen..next_blk, padding.into_iter());
                }
                <span class="kw">_ </span>=&gt; {
                    reads_complete += <span class="number">1</span>;
                }
            }

            base_idx += <span class="self">self</span>.settings.ibs;
        }

        buf.truncate(base_idx);
        <span class="prelude-val">Ok</span>(ReadStat {
            reads_complete,
            reads_partial,
            records_truncated: <span class="number">0</span>,
        })
    }

    <span class="doccomment">/// Skips amount_to_read bytes from the Input by copying into a sink
    </span><span class="kw">fn </span>read_skip(<span class="kw-2">&amp;mut </span><span class="self">self</span>, amount_to_read: u64) -&gt; std::io::Result&lt;()&gt; {
        <span class="kw">let </span>copy_result = io::copy(<span class="kw-2">&amp;mut </span><span class="self">self</span>.src.by_ref().take(amount_to_read), <span class="kw-2">&amp;mut </span>io::sink());
        <span class="kw">if let </span><span class="prelude-val">Ok</span>(n) = copy_result {
            <span class="kw">if </span>n != amount_to_read {
                io::Result::Err(io::Error::new(io::ErrorKind::UnexpectedEof, <span class="string">&quot;&quot;</span>))
            } <span class="kw">else </span>{
                <span class="prelude-val">Ok</span>(())
            }
        } <span class="kw">else </span>{
            io::Result::Err(copy_result.unwrap_err())
        }
    }
}

<span class="kw">enum </span>Density {
    Sparse,
    Dense,
}

<span class="doccomment">/// Data destinations.
</span><span class="kw">enum </span>Dest {
    <span class="doccomment">/// Output to stdout.
    </span>Stdout(Stdout),

    <span class="doccomment">/// Output to a file.
    ///
    /// The [`Density`] component indicates whether to attempt to
    /// write a sparse file when all-zero blocks are encountered.
    </span>File(File, Density),
}

<span class="kw">impl </span>Dest {
    <span class="kw">fn </span>fsync(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; io::Result&lt;()&gt; {
        <span class="kw">match </span><span class="self">self </span>{
            <span class="self">Self</span>::Stdout(stdout) =&gt; stdout.flush(),
            <span class="self">Self</span>::File(f, <span class="kw">_</span>) =&gt; {
                f.flush()<span class="question-mark">?</span>;
                f.sync_all()
            }
        }
    }

    <span class="kw">fn </span>fdatasync(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; io::Result&lt;()&gt; {
        <span class="kw">match </span><span class="self">self </span>{
            <span class="self">Self</span>::Stdout(stdout) =&gt; stdout.flush(),
            <span class="self">Self</span>::File(f, <span class="kw">_</span>) =&gt; {
                f.flush()<span class="question-mark">?</span>;
                f.sync_data()
            }
        }
    }

    <span class="kw">fn </span>seek(<span class="kw-2">&amp;mut </span><span class="self">self</span>, n: u64) -&gt; io::Result&lt;u64&gt; {
        <span class="kw">match </span><span class="self">self </span>{
            <span class="self">Self</span>::Stdout(stdout) =&gt; io::copy(<span class="kw-2">&amp;mut </span>io::repeat(<span class="number">0</span>).take(n), stdout),
            <span class="self">Self</span>::File(f, <span class="kw">_</span>) =&gt; f.seek(io::SeekFrom::Start(n)),
        }
    }

    <span class="doccomment">/// Truncate the underlying file to the current stream position, if possible.
    </span><span class="kw">fn </span>truncate(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; io::Result&lt;()&gt; {
        <span class="kw">match </span><span class="self">self </span>{
            <span class="self">Self</span>::Stdout(<span class="kw">_</span>) =&gt; <span class="prelude-val">Ok</span>(()),
            <span class="self">Self</span>::File(f, <span class="kw">_</span>) =&gt; {
                <span class="kw">let </span>pos = f.stream_position()<span class="question-mark">?</span>;
                f.set_len(pos)
            }
        }
    }
}

<span class="doccomment">/// Decide whether the given buffer is all zeros.
</span><span class="kw">fn </span>is_sparse(buf: <span class="kw-2">&amp;</span>[u8]) -&gt; bool {
    buf.iter().all(|<span class="kw-2">&amp;</span>e| e == <span class="number">0u8</span>)
}

<span class="kw">impl </span>Write <span class="kw">for </span>Dest {
    <span class="kw">fn </span>write(<span class="kw-2">&amp;mut </span><span class="self">self</span>, buf: <span class="kw-2">&amp;</span>[u8]) -&gt; io::Result&lt;usize&gt; {
        <span class="kw">match </span><span class="self">self </span>{
            <span class="self">Self</span>::File(f, Density::Sparse) <span class="kw">if </span>is_sparse(buf) =&gt; {
                <span class="kw">let </span>seek_amt: i64 = buf
                    .len()
                    .try_into()
                    .expect(<span class="string">&quot;Internal dd Error: Seek amount greater than signed 64-bit integer&quot;</span>);
                f.seek(io::SeekFrom::Current(seek_amt))<span class="question-mark">?</span>;
                <span class="prelude-val">Ok</span>(buf.len())
            }
            <span class="self">Self</span>::File(f, <span class="kw">_</span>) =&gt; f.write(buf),
            <span class="self">Self</span>::Stdout(stdout) =&gt; stdout.write(buf),
        }
    }

    <span class="kw">fn </span>flush(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; io::Result&lt;()&gt; {
        <span class="kw">match </span><span class="self">self </span>{
            <span class="self">Self</span>::Stdout(stdout) =&gt; stdout.flush(),
            <span class="self">Self</span>::File(f, <span class="kw">_</span>) =&gt; f.flush(),
        }
    }
}

<span class="doccomment">/// The destination of the data, configured with the given settings.
///
/// Use the [`Output::new_stdout`] or [`Output::new_file`] functions
/// to construct a new instance of this struct. Then use the
/// [`Output::dd_out`] function to execute the main copy operation for
/// `dd`.
</span><span class="kw">struct </span>Output&lt;<span class="lifetime">&#39;a</span>&gt; {
    <span class="doccomment">/// The destination to which bytes will be written.
    </span>dst: Dest,

    <span class="doccomment">/// Configuration settings for how to read and write the data.
    </span>settings: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>Settings,
}

<span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>&gt; Output&lt;<span class="lifetime">&#39;a</span>&gt; {
    <span class="doccomment">/// Instantiate this struct with stdout as a destination.
    </span><span class="kw">fn </span>new_stdout(settings: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>Settings) -&gt; UResult&lt;<span class="self">Self</span>&gt; {
        <span class="kw">let </span><span class="kw-2">mut </span>dst = Dest::Stdout(io::stdout());
        dst.seek(settings.seek)
            .map_err_context(|| <span class="string">&quot;write error&quot;</span>.to_string())<span class="question-mark">?</span>;
        <span class="prelude-val">Ok</span>(<span class="self">Self </span>{ dst, settings })
    }

    <span class="doccomment">/// Instantiate this struct with the named file as a destination.
    </span><span class="kw">fn </span>new_file(filename: <span class="kw-2">&amp;</span>Path, settings: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>Settings) -&gt; UResult&lt;<span class="self">Self</span>&gt; {
        <span class="kw">fn </span>open_dst(path: <span class="kw-2">&amp;</span>Path, cflags: <span class="kw-2">&amp;</span>OConvFlags, oflags: <span class="kw-2">&amp;</span>OFlags) -&gt; <span class="prelude-ty">Result</span>&lt;File, io::Error&gt; {
            <span class="kw">let </span><span class="kw-2">mut </span>opts = OpenOptions::new();
            opts.write(<span class="bool-val">true</span>)
                .create(!cflags.nocreat)
                .create_new(cflags.excl)
                .append(oflags.append);

            <span class="attribute">#[cfg(any(target_os = <span class="string">&quot;linux&quot;</span>, target_os = <span class="string">&quot;android&quot;</span>))]
            </span><span class="kw">if let </span><span class="prelude-val">Some</span>(libc_flags) = make_linux_oflags(oflags) {
                opts.custom_flags(libc_flags);
            }

            opts.open(path)
        }

        <span class="kw">let </span>dst = open_dst(filename, <span class="kw-2">&amp;</span>settings.oconv, <span class="kw-2">&amp;</span>settings.oflags)
            .map_err_context(|| <span class="macro">format!</span>(<span class="string">&quot;failed to open {}&quot;</span>, filename.quote()))<span class="question-mark">?</span>;

        <span class="comment">// Seek to the index in the output file, truncating if requested.
        //
        // Calling `set_len()` may result in an error (for example,
        // when calling it on `/dev/null`), but we don&#39;t want to
        // terminate the process when that happens.  Instead, we
        // suppress the error by calling `Result::ok()`. This matches
        // the behavior of GNU `dd` when given the command-line
        // argument `of=/dev/null`.
        </span><span class="kw">if </span>!settings.oconv.notrunc {
            dst.set_len(settings.seek).ok();
        }
        <span class="kw">let </span>density = <span class="kw">if </span>settings.oconv.sparse {
            Density::Sparse
        } <span class="kw">else </span>{
            Density::Dense
        };
        <span class="kw">let </span><span class="kw-2">mut </span>dst = Dest::File(dst, density);
        dst.seek(settings.seek)
            .map_err_context(|| <span class="string">&quot;failed to seek in output file&quot;</span>.to_string())<span class="question-mark">?</span>;
        <span class="prelude-val">Ok</span>(<span class="self">Self </span>{ dst, settings })
    }

    <span class="doccomment">/// Write the given bytes one block at a time.
    ///
    /// This may write partial blocks (for example, if the underlying
    /// call to [`Write::write`] writes fewer than `buf.len()`
    /// bytes). The returned [`WriteStat`] object will include the
    /// number of partial and complete blocks written during execution
    /// of this function.
    </span><span class="kw">fn </span>write_blocks(<span class="kw-2">&amp;mut </span><span class="self">self</span>, buf: <span class="kw-2">&amp;</span>[u8]) -&gt; io::Result&lt;WriteStat&gt; {
        <span class="kw">let </span><span class="kw-2">mut </span>writes_complete = <span class="number">0</span>;
        <span class="kw">let </span><span class="kw-2">mut </span>writes_partial = <span class="number">0</span>;
        <span class="kw">let </span><span class="kw-2">mut </span>bytes_total = <span class="number">0</span>;

        <span class="kw">for </span>chunk <span class="kw">in </span>buf.chunks(<span class="self">self</span>.settings.obs) {
            <span class="kw">let </span>wlen = <span class="self">self</span>.dst.write(chunk)<span class="question-mark">?</span>;
            <span class="kw">if </span>wlen &lt; <span class="self">self</span>.settings.obs {
                writes_partial += <span class="number">1</span>;
            } <span class="kw">else </span>{
                writes_complete += <span class="number">1</span>;
            }
            bytes_total += wlen;
        }

        <span class="prelude-val">Ok</span>(WriteStat {
            writes_complete,
            writes_partial,
            bytes_total: bytes_total.try_into().unwrap_or(<span class="number">0u128</span>),
        })
    }

    <span class="doccomment">/// Flush the output to disk, if configured to do so.
    </span><span class="kw">fn </span>sync(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; std::io::Result&lt;()&gt; {
        <span class="kw">if </span><span class="self">self</span>.settings.oconv.fsync {
            <span class="self">self</span>.dst.fsync()
        } <span class="kw">else if </span><span class="self">self</span>.settings.oconv.fdatasync {
            <span class="self">self</span>.dst.fdatasync()
        } <span class="kw">else </span>{
            <span class="comment">// Intentionally do nothing in this case.
            </span><span class="prelude-val">Ok</span>(())
        }
    }

    <span class="doccomment">/// Copy the given input data to this output, consuming both.
    ///
    /// This method contains the main loop for the `dd` program. Bytes
    /// are read in blocks from `i` and written in blocks to this
    /// output. Read/write statistics are reported to stderr as
    /// configured by the `status` command-line argument.
    ///
    /// # Errors
    ///
    /// If there is a problem reading from the input or writing to
    /// this output.
    </span><span class="kw">fn </span>dd_out&lt;R: Read&gt;(<span class="kw-2">mut </span><span class="self">self</span>, <span class="kw-2">mut </span>i: Input&lt;R&gt;) -&gt; std::io::Result&lt;()&gt; {
        <span class="comment">// The read and write statistics.
        //
        // These objects are counters, initialized to zero. After each
        // iteration of the main loop, each will be incremented by the
        // number of blocks read and written, respectively.
        </span><span class="kw">let </span><span class="kw-2">mut </span>rstat = ReadStat::default();
        <span class="kw">let </span><span class="kw-2">mut </span>wstat = WriteStat::default();

        <span class="comment">// The time at which the main loop starts executing.
        //
        // When `status=progress` is given on the command-line, the
        // `dd` program reports its progress every second or so. Part
        // of its report includes the throughput in bytes per second,
        // which requires knowing how long the process has been
        // running.
        </span><span class="kw">let </span>start = time::Instant::now();

        <span class="comment">// A good buffer size for reading.
        //
        // This is an educated guess about a good buffer size based on
        // the input and output block sizes.
        </span><span class="kw">let </span>bsize = calc_bsize(i.settings.ibs, <span class="self">self</span>.settings.obs);

        <span class="comment">// Start a thread that reports transfer progress.
        //
        // The `dd` program reports its progress after every block is written,
        // at most every 1 second, and only if `status=progress` is given on
        // the command-line or a SIGUSR1 signal is received. We
        // perform this reporting in a new thread so as not to take
        // any CPU time away from the actual reading and writing of
        // data. We send a `ProgUpdate` from the transmitter `prog_tx`
        // to the receives `rx`, and the receiver prints the transfer
        // information.
        </span><span class="kw">let </span>(prog_tx, rx) = mpsc::channel();
        <span class="kw">let </span>output_thread = thread::spawn(gen_prog_updater(rx, i.settings.status));
        <span class="kw">let </span><span class="kw-2">mut </span>progress_as_secs = <span class="number">0</span>;

        <span class="comment">// Optimization: if no blocks are to be written, then don&#39;t
        // bother allocating any buffers.
        </span><span class="kw">if let </span><span class="prelude-val">Some</span>(Num::Blocks(<span class="number">0</span>) | Num::Bytes(<span class="number">0</span>)) = i.settings.count {
            <span class="kw">return </span><span class="self">self</span>.finalize(rstat, wstat, start, <span class="kw-2">&amp;</span>prog_tx, output_thread);
        };

        <span class="comment">// Create a common buffer with a capacity of the block size.
        // This is the max size needed.
        </span><span class="kw">let </span><span class="kw-2">mut </span>buf = <span class="macro">vec!</span>[BUF_INIT_BYTE; bsize];

        <span class="comment">// The main read/write loop.
        //
        // Each iteration reads blocks from the input and writes
        // blocks to this output. Read/write statistics are updated on
        // each iteration and cumulative statistics are reported to
        // the progress reporting thread.
        </span><span class="kw">while </span>below_count_limit(<span class="kw-2">&amp;</span>i.settings.count, <span class="kw-2">&amp;</span>rstat, <span class="kw-2">&amp;</span>wstat) {
            <span class="comment">// Read a block from the input then write the block to the output.
            //
            // As an optimization, make an educated guess about the
            // best buffer size for reading based on the number of
            // blocks already read and the number of blocks remaining.
            </span><span class="kw">let </span>loop_bsize =
                calc_loop_bsize(<span class="kw-2">&amp;</span>i.settings.count, <span class="kw-2">&amp;</span>rstat, <span class="kw-2">&amp;</span>wstat, i.settings.ibs, bsize);
            <span class="kw">let </span>rstat_update = read_helper(<span class="kw-2">&amp;mut </span>i, <span class="kw-2">&amp;mut </span>buf, loop_bsize)<span class="question-mark">?</span>;
            <span class="kw">if </span>rstat_update.is_empty() {
                <span class="kw">break</span>;
            }
            <span class="kw">let </span>wstat_update = <span class="self">self</span>.write_blocks(<span class="kw-2">&amp;</span>buf)<span class="question-mark">?</span>;

            <span class="comment">// Update the read/write stats and inform the progress thread once per second.
            //
            // If the receiver is disconnected, `send()` returns an
            // error. Since it is just reporting progress and is not
            // crucial to the operation of `dd`, let&#39;s just ignore the
            // error.
            </span>rstat += rstat_update;
            wstat += wstat_update;
            <span class="kw">let </span>prog_update = ProgUpdate::new(rstat, wstat, start.elapsed(), <span class="bool-val">false</span>);
            <span class="kw">if </span>prog_update.duration.as_secs() &gt;= progress_as_secs {
                progress_as_secs = prog_update.duration.as_secs() + <span class="number">1</span>;
                prog_tx.send(prog_update).unwrap_or(());
            }
        }
        <span class="self">self</span>.finalize(rstat, wstat, start, <span class="kw-2">&amp;</span>prog_tx, output_thread)
    }

    <span class="doccomment">/// Flush output, print final stats, and join with the progress thread.
    </span><span class="kw">fn </span>finalize&lt;T&gt;(
        <span class="kw-2">&amp;mut </span><span class="self">self</span>,
        rstat: ReadStat,
        wstat: WriteStat,
        start: time::Instant,
        prog_tx: <span class="kw-2">&amp;</span>mpsc::Sender&lt;ProgUpdate&gt;,
        output_thread: thread::JoinHandle&lt;T&gt;,
    ) -&gt; std::io::Result&lt;()&gt; {
        <span class="comment">// Flush the output, if configured to do so.
        </span><span class="self">self</span>.sync()<span class="question-mark">?</span>;

        <span class="comment">// Truncate the file to the final cursor location.
        //
        // Calling `set_len()` may result in an error (for example,
        // when calling it on `/dev/null`), but we don&#39;t want to
        // terminate the process when that happens. Instead, we
        // suppress the error by calling `Result::ok()`. This matches
        // the behavior of GNU `dd` when given the command-line
        // argument `of=/dev/null`.
        </span><span class="kw">if </span>!<span class="self">self</span>.settings.oconv.notrunc {
            <span class="self">self</span>.dst.truncate().ok();
        }

        <span class="comment">// Print the final read/write statistics.
        </span><span class="kw">let </span>prog_update = ProgUpdate::new(rstat, wstat, start.elapsed(), <span class="bool-val">true</span>);
        prog_tx.send(prog_update).unwrap_or(());
        <span class="comment">// Wait for the output thread to finish
        </span>output_thread
            .join()
            .expect(<span class="string">&quot;Failed to join with the output thread.&quot;</span>);
        <span class="prelude-val">Ok</span>(())
    }
}

<span class="attribute">#[cfg(any(target_os = <span class="string">&quot;linux&quot;</span>, target_os = <span class="string">&quot;android&quot;</span>))]
</span><span class="kw">fn </span>make_linux_oflags(oflags: <span class="kw-2">&amp;</span>OFlags) -&gt; <span class="prelude-ty">Option</span>&lt;libc::c_int&gt; {
    <span class="kw">let </span><span class="kw-2">mut </span>flag = <span class="number">0</span>;

    <span class="comment">// oflag=FLAG
    </span><span class="kw">if </span>oflags.append {
        flag |= libc::O_APPEND;
    }
    <span class="kw">if </span>oflags.direct {
        flag |= libc::O_DIRECT;
    }
    <span class="kw">if </span>oflags.directory {
        flag |= libc::O_DIRECTORY;
    }
    <span class="kw">if </span>oflags.dsync {
        flag |= libc::O_DSYNC;
    }
    <span class="kw">if </span>oflags.noatime {
        flag |= libc::O_NOATIME;
    }
    <span class="kw">if </span>oflags.noctty {
        flag |= libc::O_NOCTTY;
    }
    <span class="kw">if </span>oflags.nofollow {
        flag |= libc::O_NOFOLLOW;
    }
    <span class="kw">if </span>oflags.nonblock {
        flag |= libc::O_NONBLOCK;
    }
    <span class="kw">if </span>oflags.sync {
        flag |= libc::O_SYNC;
    }

    <span class="kw">if </span>flag != <span class="number">0 </span>{
        <span class="prelude-val">Some</span>(flag)
    } <span class="kw">else </span>{
        <span class="prelude-val">None
    </span>}
}

<span class="doccomment">/// Read helper performs read operations common to all dd reads, and dispatches the buffer to relevant helper functions as dictated by the operations requested by the user.
</span><span class="kw">fn </span>read_helper&lt;R: Read&gt;(
    i: <span class="kw-2">&amp;mut </span>Input&lt;R&gt;,
    buf: <span class="kw-2">&amp;mut </span>Vec&lt;u8&gt;,
    bsize: usize,
) -&gt; std::io::Result&lt;ReadStat&gt; {
    <span class="comment">// Local Helper Fns -------------------------------------------------
    </span><span class="kw">fn </span>perform_swab(buf: <span class="kw-2">&amp;mut </span>[u8]) {
        <span class="kw">for </span>base <span class="kw">in </span>(<span class="number">1</span>..buf.len()).step_by(<span class="number">2</span>) {
            buf.swap(base, base - <span class="number">1</span>);
        }
    }
    <span class="comment">// ------------------------------------------------------------------
    // Read
    // Resize the buffer to the bsize. Any garbage data in the buffer is overwritten or truncated, so there is no need to fill with BUF_INIT_BYTE first.
    </span>buf.resize(bsize, BUF_INIT_BYTE);

    <span class="kw">let </span><span class="kw-2">mut </span>rstat = <span class="kw">match </span>i.settings.iconv.sync {
        <span class="prelude-val">Some</span>(ch) =&gt; i.fill_blocks(buf, ch)<span class="question-mark">?</span>,
        <span class="kw">_ </span>=&gt; i.fill_consecutive(buf)<span class="question-mark">?</span>,
    };
    <span class="comment">// Return early if no data
    </span><span class="kw">if </span>rstat.reads_complete == <span class="number">0 </span>&amp;&amp; rstat.reads_partial == <span class="number">0 </span>{
        <span class="kw">return </span><span class="prelude-val">Ok</span>(rstat);
    }

    <span class="comment">// Perform any conv=x[,x...] options
    </span><span class="kw">if </span>i.settings.iconv.swab {
        perform_swab(buf);
    }

    <span class="kw">match </span>i.settings.iconv.mode {
        <span class="prelude-val">Some</span>(<span class="kw-2">ref </span>mode) =&gt; {
            <span class="kw-2">*</span>buf = conv_block_unblock_helper(buf.clone(), mode, <span class="kw-2">&amp;mut </span>rstat);
            <span class="prelude-val">Ok</span>(rstat)
        }
        <span class="prelude-val">None </span>=&gt; <span class="prelude-val">Ok</span>(rstat),
    }
}

<span class="comment">// Calculate a &#39;good&#39; internal buffer size.
// For performance of the read/write functions, the buffer should hold
// both an integral number of reads and an integral number of writes. For
// sane real-world memory use, it should not be too large. I believe
// the least common multiple is a good representation of these interests.
// https://en.wikipedia.org/wiki/Least_common_multiple#Using_the_greatest_common_divisor
</span><span class="kw">fn </span>calc_bsize(ibs: usize, obs: usize) -&gt; usize {
    <span class="kw">let </span>gcd = Gcd::gcd(ibs, obs);
    <span class="comment">// calculate the lcm from gcd
    </span>(ibs / gcd) * obs
}

<span class="comment">// Calculate the buffer size appropriate for this loop iteration, respecting
// a count=N if present.
</span><span class="kw">fn </span>calc_loop_bsize(
    count: <span class="kw-2">&amp;</span><span class="prelude-ty">Option</span>&lt;Num&gt;,
    rstat: <span class="kw-2">&amp;</span>ReadStat,
    wstat: <span class="kw-2">&amp;</span>WriteStat,
    ibs: usize,
    ideal_bsize: usize,
) -&gt; usize {
    <span class="kw">match </span>count {
        <span class="prelude-val">Some</span>(Num::Blocks(rmax)) =&gt; {
            <span class="kw">let </span>rsofar = rstat.reads_complete + rstat.reads_partial;
            <span class="kw">let </span>rremain = rmax - rsofar;
            cmp::min(ideal_bsize <span class="kw">as </span>u64, rremain * ibs <span class="kw">as </span>u64) <span class="kw">as </span>usize
        }
        <span class="prelude-val">Some</span>(Num::Bytes(bmax)) =&gt; {
            <span class="kw">let </span>bmax: u128 = (<span class="kw-2">*</span>bmax).try_into().unwrap();
            <span class="kw">let </span>bremain: u128 = bmax - wstat.bytes_total;
            cmp::min(ideal_bsize <span class="kw">as </span>u128, bremain) <span class="kw">as </span>usize
        }
        <span class="prelude-val">None </span>=&gt; ideal_bsize,
    }
}

<span class="comment">// Decide if the current progress is below a count=N limit or return
// true if no such limit is set.
</span><span class="kw">fn </span>below_count_limit(count: <span class="kw-2">&amp;</span><span class="prelude-ty">Option</span>&lt;Num&gt;, rstat: <span class="kw-2">&amp;</span>ReadStat, wstat: <span class="kw-2">&amp;</span>WriteStat) -&gt; bool {
    <span class="kw">match </span>count {
        <span class="prelude-val">Some</span>(Num::Blocks(n)) =&gt; {
            <span class="kw">let </span>n = <span class="kw-2">*</span>n;
            rstat.reads_complete + rstat.reads_partial &lt;= n
        }
        <span class="prelude-val">Some</span>(Num::Bytes(n)) =&gt; {
            <span class="kw">let </span>n = (<span class="kw-2">*</span>n).try_into().unwrap();
            wstat.bytes_total &lt;= n
        }
        <span class="prelude-val">None </span>=&gt; <span class="bool-val">true</span>,
    }
}

<span class="doccomment">/// Canonicalized file name of `/dev/stdout`.
///
/// For example, if this process were invoked from the command line as
/// `dd`, then this function returns the [`OsString`] form of
/// `&quot;/dev/stdout&quot;`. However, if this process were invoked as `dd &gt;
/// outfile`, then this function returns the canonicalized path to
/// `outfile`, something like `&quot;/path/to/outfile&quot;`.
</span><span class="kw">fn </span>stdout_canonicalized() -&gt; OsString {
    <span class="kw">match </span>Path::new(<span class="string">&quot;/dev/stdout&quot;</span>).canonicalize() {
        <span class="prelude-val">Ok</span>(p) =&gt; p.into_os_string(),
        <span class="prelude-val">Err</span>(<span class="kw">_</span>) =&gt; OsString::from(<span class="string">&quot;/dev/stdout&quot;</span>),
    }
}

<span class="doccomment">/// Decide whether stdout is being redirected to a seekable file.
///
/// For example, if this process were invoked from the command line as
///
/// ```sh
/// dd if=/dev/zero bs=1 count=10 seek=5 &gt; /dev/sda1
/// ```
///
/// where `/dev/sda1` is a seekable block device then this function
/// would return true. If invoked as
///
/// ```sh
/// dd if=/dev/zero bs=1 count=10 seek=5
/// ```
///
/// then this function would return false.
</span><span class="kw">fn </span>is_stdout_redirected_to_seekable_file() -&gt; bool {
    <span class="kw">let </span>s = stdout_canonicalized();
    <span class="kw">let </span>p = Path::new(<span class="kw-2">&amp;</span>s);
    <span class="kw">match </span>File::open(p) {
        <span class="prelude-val">Ok</span>(<span class="kw-2">mut </span>f) =&gt; {
            f.seek(SeekFrom::Current(<span class="number">0</span>)).is_ok()
                &amp;&amp; f.seek(SeekFrom::End(<span class="number">0</span>)).is_ok()
                &amp;&amp; f.seek(SeekFrom::Start(<span class="number">0</span>)).is_ok()
        }
        <span class="prelude-val">Err</span>(<span class="kw">_</span>) =&gt; <span class="bool-val">false</span>,
    }
}

<span class="attribute">#[uucore::main]
</span><span class="kw">pub fn </span>uumain(args: <span class="kw">impl </span>uucore::Args) -&gt; UResult&lt;()&gt; {
    <span class="kw">let </span>args = args.collect_ignore();

    <span class="kw">let </span>matches = uu_app().try_get_matches_from(args)<span class="question-mark">?</span>;

    <span class="kw">let </span>settings: Settings = Parser::new().parse(
        <span class="kw-2">&amp;</span>matches
            .get_many::&lt;String&gt;(options::OPERANDS)
            .unwrap_or_default()
            .map(|s| s.as_ref())
            .collect::&lt;Vec&lt;<span class="kw">_</span>&gt;&gt;()[..],
    )<span class="question-mark">?</span>;

    <span class="kw">match </span>(<span class="kw-2">&amp;</span>settings.infile, <span class="kw-2">&amp;</span>settings.outfile) {
        (<span class="prelude-val">Some</span>(infile), <span class="prelude-val">Some</span>(outfile)) =&gt; {
            <span class="kw">let </span>i = Input::&lt;File&gt;::new(Path::new(<span class="kw-2">&amp;</span>infile), <span class="kw-2">&amp;</span>settings)<span class="question-mark">?</span>;
            <span class="kw">let </span>o = Output::new_file(Path::new(<span class="kw-2">&amp;</span>outfile), <span class="kw-2">&amp;</span>settings)<span class="question-mark">?</span>;
            o.dd_out(i).map_err_context(|| <span class="string">&quot;IO error&quot;</span>.to_string())
        }
        (<span class="prelude-val">None</span>, <span class="prelude-val">Some</span>(outfile)) =&gt; {
            <span class="kw">let </span>i = Input::&lt;io::Stdin&gt;::new(<span class="kw-2">&amp;</span>settings)<span class="question-mark">?</span>;
            <span class="kw">let </span>o = Output::new_file(Path::new(<span class="kw-2">&amp;</span>outfile), <span class="kw-2">&amp;</span>settings)<span class="question-mark">?</span>;
            o.dd_out(i).map_err_context(|| <span class="string">&quot;IO error&quot;</span>.to_string())
        }
        (<span class="prelude-val">Some</span>(infile), <span class="prelude-val">None</span>) =&gt; {
            <span class="kw">let </span>i = Input::&lt;File&gt;::new(Path::new(<span class="kw-2">&amp;</span>infile), <span class="kw-2">&amp;</span>settings)<span class="question-mark">?</span>;
            <span class="kw">if </span>is_stdout_redirected_to_seekable_file() {
                <span class="kw">let </span>filename = stdout_canonicalized();
                <span class="kw">let </span>o = Output::new_file(Path::new(<span class="kw-2">&amp;</span>filename), <span class="kw-2">&amp;</span>settings)<span class="question-mark">?</span>;
                o.dd_out(i).map_err_context(|| <span class="string">&quot;IO error&quot;</span>.to_string())
            } <span class="kw">else </span>{
                <span class="kw">let </span>o = Output::new_stdout(<span class="kw-2">&amp;</span>settings)<span class="question-mark">?</span>;
                o.dd_out(i).map_err_context(|| <span class="string">&quot;IO error&quot;</span>.to_string())
            }
        }
        (<span class="prelude-val">None</span>, <span class="prelude-val">None</span>) =&gt; {
            <span class="kw">let </span>i = Input::&lt;io::Stdin&gt;::new(<span class="kw-2">&amp;</span>settings)<span class="question-mark">?</span>;
            <span class="kw">if </span>is_stdout_redirected_to_seekable_file() {
                <span class="kw">let </span>filename = stdout_canonicalized();
                <span class="kw">let </span>o = Output::new_file(Path::new(<span class="kw-2">&amp;</span>filename), <span class="kw-2">&amp;</span>settings)<span class="question-mark">?</span>;
                o.dd_out(i).map_err_context(|| <span class="string">&quot;IO error&quot;</span>.to_string())
            } <span class="kw">else </span>{
                <span class="kw">let </span>o = Output::new_stdout(<span class="kw-2">&amp;</span>settings)<span class="question-mark">?</span>;
                o.dd_out(i).map_err_context(|| <span class="string">&quot;IO error&quot;</span>.to_string())
            }
        }
    }
}

<span class="kw">pub fn </span>uu_app() -&gt; Command {
    Command::new(uucore::util_name())
        .version(<span class="macro">crate_version!</span>())
        .about(ABOUT)
        .after_help(AFTER_HELP)
        .infer_long_args(<span class="bool-val">true</span>)
        .arg(Arg::new(options::OPERANDS).num_args(<span class="number">1</span>..))
}

<span class="attribute">#[cfg(test)]
</span><span class="kw">mod </span>tests {
    <span class="kw">use crate</span>::{calc_bsize, Output, Parser};

    <span class="kw">use </span>std::path::Path;

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>bsize_test_primes() {
        <span class="kw">let </span>(n, m) = (<span class="number">7901</span>, <span class="number">7919</span>);
        <span class="kw">let </span>res = calc_bsize(n, m);
        <span class="macro">assert!</span>(res % n == <span class="number">0</span>);
        <span class="macro">assert!</span>(res % m == <span class="number">0</span>);

        <span class="macro">assert_eq!</span>(res, n * m);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>bsize_test_rel_prime_obs_greater() {
        <span class="kw">let </span>(n, m) = (<span class="number">7 </span>* <span class="number">5119</span>, <span class="number">13 </span>* <span class="number">5119</span>);
        <span class="kw">let </span>res = calc_bsize(n, m);
        <span class="macro">assert!</span>(res % n == <span class="number">0</span>);
        <span class="macro">assert!</span>(res % m == <span class="number">0</span>);

        <span class="macro">assert_eq!</span>(res, <span class="number">7 </span>* <span class="number">13 </span>* <span class="number">5119</span>);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>bsize_test_rel_prime_ibs_greater() {
        <span class="kw">let </span>(n, m) = (<span class="number">13 </span>* <span class="number">5119</span>, <span class="number">7 </span>* <span class="number">5119</span>);
        <span class="kw">let </span>res = calc_bsize(n, m);
        <span class="macro">assert!</span>(res % n == <span class="number">0</span>);
        <span class="macro">assert!</span>(res % m == <span class="number">0</span>);

        <span class="macro">assert_eq!</span>(res, <span class="number">7 </span>* <span class="number">13 </span>* <span class="number">5119</span>);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>bsize_test_3fac_rel_prime() {
        <span class="kw">let </span>(n, m) = (<span class="number">11 </span>* <span class="number">13 </span>* <span class="number">5119</span>, <span class="number">7 </span>* <span class="number">11 </span>* <span class="number">5119</span>);
        <span class="kw">let </span>res = calc_bsize(n, m);
        <span class="macro">assert!</span>(res % n == <span class="number">0</span>);
        <span class="macro">assert!</span>(res % m == <span class="number">0</span>);

        <span class="macro">assert_eq!</span>(res, <span class="number">7 </span>* <span class="number">11 </span>* <span class="number">13 </span>* <span class="number">5119</span>);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>bsize_test_ibs_greater() {
        <span class="kw">let </span>(n, m) = (<span class="number">512 </span>* <span class="number">1024</span>, <span class="number">256 </span>* <span class="number">1024</span>);
        <span class="kw">let </span>res = calc_bsize(n, m);
        <span class="macro">assert!</span>(res % n == <span class="number">0</span>);
        <span class="macro">assert!</span>(res % m == <span class="number">0</span>);

        <span class="macro">assert_eq!</span>(res, n);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>bsize_test_obs_greater() {
        <span class="kw">let </span>(n, m) = (<span class="number">256 </span>* <span class="number">1024</span>, <span class="number">512 </span>* <span class="number">1024</span>);
        <span class="kw">let </span>res = calc_bsize(n, m);
        <span class="macro">assert!</span>(res % n == <span class="number">0</span>);
        <span class="macro">assert!</span>(res % m == <span class="number">0</span>);

        <span class="macro">assert_eq!</span>(res, m);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>bsize_test_bs_eq() {
        <span class="kw">let </span>(n, m) = (<span class="number">1024</span>, <span class="number">1024</span>);
        <span class="kw">let </span>res = calc_bsize(n, m);
        <span class="macro">assert!</span>(res % n == <span class="number">0</span>);
        <span class="macro">assert!</span>(res % m == <span class="number">0</span>);

        <span class="macro">assert_eq!</span>(res, m);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_nocreat_causes_failure_when_ofile_doesnt_exist() {
        <span class="kw">let </span>args = <span class="kw-2">&amp;</span>[<span class="string">&quot;conv=nocreat&quot;</span>, <span class="string">&quot;of=not-a-real.file&quot;</span>];
        <span class="kw">let </span>settings = Parser::new().parse(args).unwrap();
        <span class="macro">assert!</span>(
            Output::new_file(Path::new(settings.outfile.as_ref().unwrap()), <span class="kw-2">&amp;</span>settings).is_err()
        );
    }
}
</code></pre></div>
</section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="uu_dd" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.66.1 (90743e729 2023-01-10)" ></div></body></html>